# О Packer

Инструмент **Packer**. Позволяет удобно создавать образы виртуальных машин.

https://www.packer.io/

## Для чего нужны образы

Когда вы завершаете создание проекта, нужно перенести его из тестовой среды в рабочую. Здесь возникают две проблемы. Во-первых, чтобы решение гарантированно работало, рабочая среда должна как можно меньше отличаться от той, в которой проект создавался и тестировался. Во-вторых, проект нужно тиражировать, т.е. устанавливать и настраивать ПО на серверах или облачных платформах. Создание шаблона — образа виртуальной машины с предустановленным ПО — помогает ускорить этот процесс и уменьшить количество ошибок.

Готовые образы, доступные в [маркетплейсе](https://cloud.yandex.ru/marketplace), содержат различные версии операционных систем или наборы программ. Однако они не решают проблему быстрого масштабирования проекта. Образ с предустановленным ПО можно создать с помощью **Packer**.

## Как создать образ при помощи Packer

**Packer** работает следующим образом: вы предоставляете ему текстовый файл — **спецификацию** — с описанием сборки образа, а на выходе получаете готовый образ.

Давайте создадим образ с *Ubuntu* и веб-сервером *NGINX*. Описание образа можно составить на языке HCL ([HashiCorp Language](https://www.packer.io/docs/templates/hcl_templates)).

```hcl
source "yandex" "ubuntu-nginx" {
  token               = "<OAuth-токен>"
  folder_id           = "<идентификатор_каталога>"
  source_image_family = "ubuntu-2004-lts"
  ssh_username        = "ubuntu"
  use_ipv4_nat        = "true"
  image_description   = "my custom ubuntu with nginx"
  image_family        = "ubuntu-2004-lts"
  image_name          = "my-ubuntu-nginx"
  subnet_id           = "<идентификатор_подсети>"
  disk_type           = "network-ssd"
  zone                = "ru-central1-a"
}

build {
  sources = ["source.yandex.ubuntu-nginx"]

  provisioner "shell" {
    inline = ["sudo apt-get update -y",
              "sudo apt-get install -y nginx",
              "sudo systemctl enable nginx.service"
             ]
  }
}

```

В этом примере указано создание образа в *Yandex Cloud* с установленным *NGINX*. Параметры, такие как **`token`**, **`folder_id`**, **`image_name`**, и другие, должны быть заменены реальными значениями.

Сохраните этот файл как **`my-ubuntu-nginx.pkr.hcl`** и используйте команду:

```bash
bashCopy code
packer build my-ubuntu-nginx.pkr.hcl

```

Остальные параметры и возможности **Packer** подробно описаны в [документации](https://www.packer.io/docs/).

## **Зачем нужно хранить шаблоны Packer**

**Packer** позволяет создавать образы для различных платформ, и хранение шаблонов в системе контроля версий (например, на GitHub) обеспечивает:

- Отслеживание изменений.
- Возможность откатываться к предыдущим версиям.
- Совместную работу нескольких разработчиков.

Подход, когда конфигурация обрабатывается как код, называется *Infrastructure as Code*.

```markdown

Этот файл `README.md` содержит краткое описание **Packer**, принципа его работы и примера использования. Пожалуйста, убедитесь, что вы заменили фиктивные значения, такие как `<OAuth-токен>`, `<идентификатор_каталога>`, `<идентификатор_подсети>`, на реальные ваши данные перед использованием шаблона `my-ubuntu-nginx.pkr.hcl`.

```
